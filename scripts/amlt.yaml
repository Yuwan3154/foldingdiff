description: test job
# Build takes about 30 minutes

target:
  service: sing  # Target service platform
  name: msrresrchvc  # reference to cluster and its corresponding fields
  workspace_name: msrresrchws  # AML workspace name to use

environment: # https://singularitydocs.azurewebsites.net/docs/container_images/
  # image: amlt-sing/pytorch-1.10.0-a100 # run amlt cache base-images
  image: amlt-sing/pytorch-1.11.0
  conda_yaml_file: $CONFIG_DIR/../environment.yml
  skip_conda_packages_on_sing: ['python', 'torch', 'tensorflow', 'cudatoolkit', 'deepspeed', 'pip', 'jupyter', 'black', 'gpustat']
  setup:
    - pip install git+https://github.com/microsoft/protein-sequence-models.git

code:
  local_dir: $CONFIG_DIR/..  # elative to config file directory

jobs:
- name: foobarbaz  # Unique name for each job
  sku: G1 # G1 = any 1 GPU, 8C1 = 8 GB ram, 1 core; 80G1-A100 = A100 GPU, run amlt target list singularity -v
  priority: high
  command:
  - python bin/train.py -h